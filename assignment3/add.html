<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <title>Fridge Manager - 추가</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="my.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

 
    <script>
        
        (function (w) {
            const DEFAULT = {
                nextId: 11, // 기본 10개가 있으므로 11부터
                items: [
                    { id: 1, name: '계란', qty: 30, type: '냉장', status: '좋음', buy: '2025-09-25', expire: '2025-10-10', price: 7800, note: '' },
                    { id: 2, name: '닭가슴살', qty: 6, type: '냉동', status: '좋음', buy: '2025-09-18', expire: '2025-12-01', price: 12000, note: '' },
                    { id: 3, name: '상추', qty: 2, type: '냉장', status: '빨리 먹어야 함', buy: '2025-09-29', expire: '2025-10-03', price: 2500, note: '샐러드' },
                    { id: 4, name: '우유', qty: 1, type: '냉장', status: '빨리 먹어야 함', buy: '2025-09-28', expire: '2025-10-02', price: 2300, note: '' },
                    { id: 5, name: '만두', qty: 2, type: '냉동', status: '좋음', buy: '2025-09-20', expire: '2026-03-01', price: 9800, note: '' },
                    { id: 6, name: '베이컨', qty: 1, type: '냉장', status: '좋음', buy: '2025-09-27', expire: '2025-10-15', price: 5200, note: '' },
                    { id: 7, name: '요거트', qty: 4, type: '냉장', status: '좋음', buy: '2025-09-30', expire: '2025-10-07', price: 4800, note: '' },
                    { id: 8, name: '아이스크림', qty: 5, type: '냉동', status: '좋음', buy: '2025-09-15', expire: '2026-09-15', price: 15000, note: '' },
                    { id: 9, name: '돼지고기', qty: 2, type: '냉동', status: '좋음', buy: '2025-09-10', expire: '2026-01-10', price: 18000, note: '' },
                    { id: 10, name: '치즈', qty: 3, type: '냉장', status: '좋음', buy: '2025-09-26', expire: '2025-12-01', price: 6200, note: '' },
                ]
            };

            function load() {
                try {
                    if (!w.name) return structuredClone(DEFAULT);
                    const obj = JSON.parse(w.name);
                    if (!obj || !Array.isArray(obj.items) || !Number.isInteger(obj.nextId)) return structuredClone(DEFAULT);
                    return obj;
                } catch (e) { return structuredClone(DEFAULT); }
            }
            function save(db) { w.name = JSON.stringify(db); }

            const DB = {
                _state: load(),
                all() { return this._state.items.slice(); },
                get(id) { return this._state.items.find(x => String(x.id) === String(id)); },
                add(rec) {
                    const id = this._state.nextId++;
                    const item = { id, ...rec };
                    this._state.items.unshift(item);
                    save(this._state);
                    return item;
                },
                update(id, patch) {
                    const idx = this._state.items.findIndex(x => String(x.id) === String(id));
                    if (idx < 0) return null;
                    this._state.items[idx] = { ...this._state.items[idx], ...patch };
                    save(this._state);
                    return this._state.items[idx];
                },
                remove(id) {
                    const before = this._state.items.length;
                    this._state.items = this._state.items.filter(x => String(x.id) !== String(id));
                    save(this._state);
                    return this._state.items.length !== before;
                }
                
            };
            w.DB = DB;
        })(window);
        
    </script>

</head>

<body>
    <div class="container py-4">
        <h1>식품 추가</h1>
        <form id="f" class="bg-white p-3 rounded shadow-sm">
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">이름 *</label>
                    <input name="name" class="form-control" required>
                    <div class="invalid-feedback">이름은 2~40자</div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">수량 *</label>
                    <input type="number" name="qty" class="form-control" min="1" required>
                    <div class="invalid-feedback">1 이상 정수</div>
                </div>
                <div class="col-md-3">
                    <label class="form-label">종류 *</label>
                    <select name="type" class="form-select" required>
                        <option value="">선택</option>
                        <option>냉장</option>
                        <option>냉동</option>
                    </select>
                    <div class="invalid-feedback">종류를 선택</div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">상태 *</label>
                    <select name="status" class="form-select" required>
                        <option value="">선택</option>
                        <option>좋음</option>
                        <option>빨리 먹어야 함</option>
                        <option>폐기 예정</option>
                    </select>
                    <div class="invalid-feedback">상태를 선택</div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">구매일 *</label>
                    <input type="date" name="buy" class="form-control" required>
                    <div class="invalid-feedback">오늘 이후 불가</div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">소비기한 *</label>
                    <input type="date" name="expire" class="form-control" required>
                    <div class="invalid-feedback">구매일 이후</div>
                </div>
                <div class="col-md-4">
                    <label class="form-label">가격(원) *</label>
                    <input type="number" name="price" class="form-control" min="0" required>
                    <div class="invalid-feedback">0 이상</div>
                </div>
                <div class="col-12">
                    <label class="form-label">비고</label>
                    <textarea name="note" class="form-control" rows="2"></textarea>
                </div>
            </div>

            <div class="mt-4 d-flex gap-2">
                <button class="btn btn-primary">확인</button>
                <a href="index.html" class="btn btn-secondary">목록</a>
            </div>
        </form>
    </div>

    <script>
        function validate(fd, form) {
            let ok = true;
            const name = fd.get('name').trim(); 
            const nameEl = form.elements['name'];
            
            if (name.length < 2 || name.length > 40) {
                nameEl.classList.add('is-invalid'); 
                ok = false; 
            } 
            else nameEl.classList.remove('is-invalid');
            
            const qty = parseInt(fd.get('qty'), 10); 
            const qtyEl = form.elements['qty'];
            if (!(qty >= 1)) { qtyEl.classList.add('is-invalid'); 
            ok = false; 
            } 
            else qtyEl.classList.remove('is-invalid');
            
            const buy = fd.get('buy'), exp = fd.get('expire'), 
            today = new Date().toISOString().slice(0, 10);
            const bEl = form.elements['buy'], eEl = form.elements['expire'];
            
            if (!buy || buy > today) { 
                bEl.classList.add('is-invalid'); ok = false; 
            } 
            else bEl.classList.remove('is-invalid');
            
            if (!exp || (buy && exp <= buy)) { 
                eEl.classList.add('is-invalid'); ok = false; 
            } 
            else eEl.classList.remove('is-invalid');
            
            const tEl = form.elements['type']; 
            if (!fd.get('type')) { 
                tEl.classList.add('is-invalid'); 
                ok = false; 
            } else tEl.classList.remove('is-invalid');
            const sEl = form.elements['status']; if (!fd.get('status')) { 
                sEl.classList.add('is-invalid'); 
                ok = false; 
            } 
            else sEl.classList.remove('is-invalid');
            
            const p = Number(fd.get('price')), pEl = form.elements['price']; 
            if (!(p >= 0)) { pEl.classList.add('is-invalid'); ok = false; } 
            else pEl.classList.remove('is-invalid');
            
            return ok;
        }

        $('#f').on('submit', function (e) {
            e.preventDefault();
            const fd = new FormData(this);
            if (!validate(fd, this)) return;
            alert('게시물이 추가됩니다');
            DB.add({
                name: fd.get('name').trim(), qty: parseInt(fd.get('qty'), 10), type: fd.get('type'),
                status: fd.get('status'), buy: fd.get('buy'), expire: fd.get('expire'),
                price: Number(fd.get('price')), note: (fd.get('note') || '').trim()
            });
            location.href = 'index.html';
        });
    </script>
</body>

</html>
