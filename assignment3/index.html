<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Fridge Manager - 목록</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
  <link href="my.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  
  <script>

(function (w){
  const DEFAULT = {
    nextId: 11, // 기본 10개가 있으므로 11부터
    items: [
      {id:1,name:'계란',qty:30,type:'냉장',status:'좋음',buy:'2025-09-25',expire:'2025-10-10',price:7800,note:''},
      {id:2,name:'닭가슴살',qty:6,type:'냉동',status:'좋음',buy:'2025-09-18',expire:'2025-12-01',price:12000,note:''},
      {id:3,name:'상추',qty:2,type:'냉장',status:'빨리 먹어야 함',buy:'2025-09-29',expire:'2025-10-03',price:2500,note:'샐러드'},
      {id:4,name:'우유',qty:1,type:'냉장',status:'빨리 먹어야 함',buy:'2025-09-28',expire:'2025-10-02',price:2300,note:''},
      {id:5,name:'만두',qty:2,type:'냉동',status:'좋음',buy:'2025-09-20',expire:'2026-03-01',price:9800,note:''},
      {id:6,name:'베이컨',qty:1,type:'냉장',status:'좋음',buy:'2025-09-27',expire:'2025-10-15',price:5200,note:''},
      {id:7,name:'요거트',qty:4,type:'냉장',status:'좋음',buy:'2025-09-30',expire:'2025-10-07',price:4800,note:''},
      {id:8,name:'아이스크림',qty:5,type:'냉동',status:'좋음',buy:'2025-09-15',expire:'2026-09-15',price:15000,note:''},
      {id:9,name:'돼지고기',qty:2,type:'냉동',status:'좋음',buy:'2025-09-10',expire:'2026-01-10',price:18000,note:''},
      {id:10,name:'치즈',qty:3,type:'냉장',status:'좋음',buy:'2025-09-26',expire:'2025-12-01',price:6200,note:''},
    ]
  };

  function load(){
    try{
      if(!w.name) return structuredClone(DEFAULT);
      const obj = JSON.parse(w.name);
      if(!obj || !Array.isArray(obj.items) || !Number.isInteger(obj.nextId)) return structuredClone(DEFAULT);
      return obj;
    }catch(e){ return structuredClone(DEFAULT); }
  }
  function save(db){ w.name = JSON.stringify(db); }

  const DB = {
    _state: load(),
    all(){ return this._state.items.slice(); },
    get(id){ return this._state.items.find(x=> String(x.id)===String(id)); },
    add(rec){
      const id = this._state.nextId++;
      const item = { id, ...rec };
      this._state.items.unshift(item);
      save(this._state);
      return item;
    },
    update(id, patch){
      const idx = this._state.items.findIndex(x=> String(x.id)===String(id));
      if(idx<0) return null;
      this._state.items[idx] = { ...this._state.items[idx], ...patch };
      save(this._state);
      return this._state.items[idx];
    },
    remove(id){
      const before = this._state.items.length;
      this._state.items = this._state.items.filter(x=> String(x.id)!==String(id));
      save(this._state);
      return this._state.items.length !== before;
    }
  };
  w.DB = DB;
})(window);

</script>

</head>
<body>
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="mb-0">식품 목록</h1>
      <div class="d-flex gap-2">
        <a href="add.html" class="btn btn-success"><i class="ri-add-circle-line"></i> 추가</a>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-hover bg-white">
        <thead class="table-light">
          <tr><th>#</th><th>이름</th><th>종류</th><th>수량</th><th>상태</th><th>구매일</th><th>소비기한</th><th>가격</th><th>Action</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const fmt = n => new Intl.NumberFormat('ko-KR').format(n);

    function render(){
      const list = DB.all();
      $("#tbody").html(list.map((it,i)=>`
        <tr>
          <td data-label="#">${i+1}</td>
          <td data-label="이름"><a href="view.html?id=${it.id}">${it.name}</a></td>
          <td data-label="종류">${it.type}</td>
          <td data-label="수량">${it.qty}</td>
          <td data-label="상태">${it.status}</td>
          <td data-label="구매일">${it.buy}</td>
          <td data-label="소비기한">${it.expire}</td>
          <td data-label="가격">${fmt(it.price)}</td>
          <td data-label="Action" class="text-nowrap">
            <a href="edit.html?id=${it.id}" class="btn btn-sm btn-outline-primary"><i class="ri-edit-2-line"></i> 수정</a>
            <button class="btn btn-sm btn-outline-danger btn-del" data-id="${it.id}"><i class="ri-delete-bin-6-line"></i> 삭제</button>
          </td>
        </tr>
      `).join(''));
    }

    $(document).on('click', '.btn-del', function(){
      const id = $(this).data('id');
      if(confirm('게시물을 삭제할까요?')){
        DB.remove(id);
        render();
      }
    });
  

    $(function(){ render(); });
  </script>
</body>
</html>
